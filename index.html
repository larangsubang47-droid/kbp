<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Input Data Operator - BUMN Water Treatment</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Sistem Input Data Operator</h1>
            <p>Clean Water Production Recording Report - BUMN untuk Indonesia</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('input')">üìù Input Data</button>
            <button class="tab" onclick="switchTab('history')">üìú History</button>
            <button class="tab" onclick="switchTab('config')">‚öôÔ∏è Konfigurasi</button>
        </div>

        <!-- Tab Input Data -->
        <div id="input" class="tab-content active">
            <div class="alert" id="alert"></div>

            <form id="dataForm">
                <div class="form-section">
                    <div class="section-title">Informasi Umum</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tanggal</label>
                            <input type="date" id="tanggal" required>
                        </div>
                        <div class="form-group">
                            <label>Operator Shift</label>
                            <input type="text" id="operator" placeholder="Nama Operator" required>
                        </div>
                        <div class="form-group">
                            <label>Shift</label>
                            <select id="shift" required>
                                <option value="">Pilih Shift</option>
                                <option value="Shift 1">Shift 1</option>
                                <option value="Shift 2">Shift 2</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Level Air</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">üìä Air Baku Intake (Mdpl)</div>
                        <div class="time-grid" id="air-baku-intake-mdpl"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üìä Air Baku Intake (cm)</div>
                        <div class="time-grid" id="air-baku-intake"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üìä Reservoir (cm)</div>
                        <div class="time-grid" id="reservoir"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Flow/Debit (Lps)</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">üíß Inlet WTP</div>
                        <div class="time-grid" id="inlet-wtp"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üíß Outlet WTP</div>
                        <div class="time-grid" id="outlet-wtp"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Pressure Distribusi (Bar)</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">‚öôÔ∏è Pompa 1</div>
                        <div class="time-grid" id="pressure-pompa1"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">‚öôÔ∏è Pompa 2</div>
                        <div class="time-grid" id="pressure-pompa2"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">‚öôÔ∏è Pompa 3</div>
                        <div class="time-grid" id="pressure-pompa3"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Hz Distribusi (Hz)</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">üîÑ Pompa 1</div>
                        <div class="time-grid" id="hz-pompa1"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üîÑ Pompa 2</div>
                        <div class="time-grid" id="hz-pompa2"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üîÑ Pompa 3</div>
                        <div class="time-grid" id="hz-pompa3"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Pressure Intake (Bar)</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">‚öôÔ∏è Pompa 1</div>
                        <div class="time-grid" id="pressure-intake-pompa1"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">‚öôÔ∏è Pompa 2</div>
                        <div class="time-grid" id="pressure-intake-pompa2"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">‚öôÔ∏è Pompa 3</div>
                        <div class="time-grid" id="pressure-intake-pompa3"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Hz Intake (Hz)</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">üîÑ Pompa 1</div>
                        <div class="time-grid" id="hz-intake-pompa1"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üîÑ Pompa 2</div>
                        <div class="time-grid" id="hz-intake-pompa2"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üîÑ Pompa 3</div>
                        <div class="time-grid" id="hz-intake-pompa3"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Kwh Meter (Kwh)</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">‚ö° WBP/EA_EXP1</div>
                        <div class="time-grid" id="kwh-wbp-exp1"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">‚ö° LWBP1/EA_EXP2</div>
                        <div class="time-grid" id="kwh-lwbp1-exp2"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">‚ö° LWBP2/EA_EXP3</div>
                        <div class="time-grid" id="kwh-lwbp2-exp3"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">‚ö° Total/EA_TOT</div>
                        <div class="time-grid" id="kwh-total-ea-tot"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Backwash Filter (Unit)</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">üîß Plan 1</div>
                        <div class="time-grid" id="backwash-plan1"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üîß Plan 2</div>
                        <div class="time-grid" id="backwash-plan2"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Info WDC</div>
                    
                    <div class="parameter-card">
                        <div class="parameter-title">üìà Level WDC (%)</div>
                        <div class="time-grid" id="level-wdc"></div>
                    </div>

                    <div class="parameter-card">
                        <div class="parameter-title">üíß LPS OUT WDC</div>
                        <div class="time-grid" id="lps-out-wdc"></div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Catatan Tambahan</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Total WM Air Baku (M3)</label>
                            <input type="text" id="total-wm-air-baku" placeholder="Contoh: 613349">
                        </div>
                        <div class="form-group">
                            <label>Total WM Air Bersih (M3)</label>
                            <input type="text" id="total-wm-air-bersih" placeholder="Contoh: 650770.051">
                        </div>
                        <div class="form-group">
                            <label>Catatan Khusus</label>
                            <input type="text" id="catatan" placeholder="Catatan jika ada">
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">üóëÔ∏è Reset Form</button>
                    <button type="submit" class="btn btn-primary">üíæ Simpan ke Google Sheets</button>
                </div>
            </form>
        </div>

        <!-- Tab History -->
        <div id="history" class="tab-content">
            <div class="form-section">
                <div class="section-title">Data History</div>
                <div class="button-group" style="justify-content: flex-start;">
                    <button class="btn btn-success" onclick="exportToExcel()">üì• Export ke Excel</button>
                    <button class="btn btn-secondary" onclick="loadHistory()">üîÑ Refresh Data</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Operator</th>
                                <th>Shift</th>
                                <th>Jam Input</th>
                                <th>Total Air Baku (M3)</th>
                                <th>Total Air Bersih (M3)</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    Belum ada data. Silakan konfigurasi Google Sheets terlebih dahulu.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Konfigurasi -->
        <div id="config" class="tab-content">
            <div class="info-box">
                <h3>üìã Cara Setup Google Sheets (PENTING - IKUTI STEP BY STEP)</h3>
                <ol>
                    <li><strong>Buat Google Sheets baru</strong> di Google Drive Anda</li>
                    <li>Beri nama sheet, misalnya "Data Operator WTP"</li>
                    <li>Klik menu <strong>Extensions</strong> ‚Üí <strong>Apps Script</strong></li>
                    <li>Hapus semua kode yang ada (function myFunction, dll)</li>
                    <li>Copy-paste kode dari file <strong>google-apps-script.js</strong></li>
                    <li>Klik tombol <strong>üíæ Save</strong> (icon disket) atau Ctrl+S</li>
                    <li>Klik tombol <strong>Deploy</strong> ‚Üí <strong>New deployment</strong></li>
                    <li>Klik icon ‚öôÔ∏è (roda gigi) di samping "Select type"</li>
                    <li>Pilih <strong>Web app</strong></li>
                    <li>Isi form deploy:
                        <ul>
                            <li>Description: "Operator Input System" (bebas)</li>
                            <li>Execute as: <strong>Me (email Anda)</strong></li>
                            <li>Who has access: <strong>Anyone</strong> ‚ö†Ô∏è PENTING!</li>
                        </ul>
                    </li>
                    <li>Klik <strong>Deploy</strong></li>
                    <li>Akan muncul popup "Authorize access" ‚Üí Klik <strong>Authorize access</strong></li>
                    <li>Pilih akun Google Anda</li>
                    <li>Klik <strong>Advanced</strong> ‚Üí <strong>Go to [nama project] (unsafe)</strong></li>
                    <li>Klik <strong>Allow</strong></li>
                    <li>Copy <strong>Web app URL</strong> yang muncul (harus yang berakhiran /exec)</li>
                    <li>Paste URL tersebut di form konfigurasi di bawah</li>
                    <li>Klik <strong>Test Koneksi</strong> untuk memastikan berhasil</li>
                </ol>
            </div>

            <div class="info-box warning">
                <h3>‚ö†Ô∏è Troubleshooting - Jika Data Tidak Masuk:</h3>
                <ol>
                    <li><strong>Pastikan URL yang Anda copy berakhiran /exec</strong> (bukan /dev)</li>
                    <li><strong>Pastikan "Who has access" diset ke "Anyone"</strong> bukan "Only myself"</li>
                    <li>Coba klik <strong>Deploy</strong> ‚Üí <strong>Manage deployments</strong> ‚Üí Edit ‚Üí <strong>New version</strong></li>
                    <li>Pastikan browser tidak memblokir popup</li>
                    <li>Coba buka URL Apps Script di tab baru - harus muncul pesan JSON</li>
                    <li>Periksa Google Sheets - seharusnya ada sheet dengan nama yang Anda buat</li>
                </ol>
            </div>

            <div class="config-section">
                <div class="section-title">Konfigurasi Google Sheets</div>
                <div class="form-group">
                    <label>Google Apps Script Web App URL</label>
                    <input type="url" id="sheetUrl" placeholder="https://script.google.com/macros/s/...../exec">
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveConfig()">üíæ Simpan Konfigurasi</button>
                    <button class="btn btn-secondary" onclick="testConnection()">üîå Test Koneksi</button>
                </div>
            </div>

            <div class="config-section">
                <div class="section-title">File Google Apps Script</div>
                <p style="margin-bottom: 10px;">Copy kode dari file <strong>google-apps-script.js</strong> dan paste ke Google Apps Script Editor</p>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>